<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokedle - Multi-Modes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <a href="javascript:location.reload()">
            <img class="Titre" src="Pokedle.png" alt="Logo Pokedle">
        </a>
        <div id="soustitre-accueil" class="sous-titre">
            <h2>Tous les jours, devine un Pokemon !</h2>
        </div>
    </header>

    <main id="page-content">
        <div id="menu-principal" class="menu-vertical">
            <div class="card">
                <h2>CLASSIQUE</h2>
                <button class="button" onclick="changerMenu('classique')">
                    <img src="zarbi" alt="Zarbi">
                    <span>Toutes les générations</span>
                </button>
            </div>
            <div class="card">
                <h2>CARTE</h2>
                <button class="button" onclick="changerMenu('carte')">
                    <img src="zarbi2.png" alt="Zarbi2">
                    <span>Avec une carte floutée</span>
                </button>
            </div>
            <div class="card">
                <h2>DESCRIPTION</h2>
                <button class="button" onclick="changerMenu('description')">
                    <img src="salameche.png" alt="Salameche">
                    <span>Indices du Pokédex</span>
                </button>
            </div>
            <div class="card">
                <h2>OMBRE</h2>
                <button class="button" onclick="changerMenu('ombre')">
                    <img src="ombre.png" alt="Ombre">
                    <span>Devine la silhouette</span>
                </button>
            </div>
        </div>

        <div id="zone-jeu" class="hidden">
            <h2 id="titre-mode" style="text-align: center; color: white; text-shadow: 2px 2px black;"></h2>
            
            <div id="contenu-dynamique-du-jeu"></div>

            <div id="devinette-container" class="menu-vertical hidden" style="margin-top: 20px;">
                <div id="compteur-essais" style="color: #FFCB05; font-weight: bold; margin-bottom: 10px; font-size: 1.2rem; text-shadow: 1px 1px black;">
                    ESSAIS : 0
                </div>

                <input type="text" id="input-pokemon" placeholder="Nom du Pokémon..." 
                       style="padding: 10px; border-radius: 10px; border: 2px solid #2f4f2f; font-family: Arial, sans-serif; width: 250px; text-align: center; font-size: 16px;">
                
                <button class="button" onclick="verifierReponse()" style="width: 200px; background: #FFCB05; color: #3b4cca; margin-top: 10px;">
                    VALIDER
                </button>
                
                <p id="message-retour" style="color: white; font-weight: bold; text-shadow: 1px 1px black; min-height: 25px; text-align: center; margin-top: 10px;"></p>
            </div>

            <button class="button" id="btn-retour-style" onclick="retourMenu()" style="margin-top: 30px;">
                RETOUR AU MENU
            </button>
        </div>
    </main>

    <footer>
        <p>pokedle.net — 2025</p>
        <div class="social-links">

            <a href="https://www.instagram.com/iblamegaetan/"><img src="insta.png" alt="Instagram"></a>

            <a href="https://www.youtube.com/@fayzhan5977"><img src="youtube.png" alt="YouTube"></a>

            <a href="https://github.com/FayzhanDev"><img src="github.png" alt="GitHub"></a>

        </div>
        <p>Developpeur : Gaetan Demoy</p>
    </footer>

<script>
let pokemonATrouver = "";
let modeActuel = "";
let flouActuel = 20;
let essais = 0;

function simplifierTexte(texte) {
    if (!texte) return "";
    return texte.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]/g, "").trim();
}

async function changerMenu(mode) {
    modeActuel = mode;
    flouActuel = 20;
    essais = 0;
    document.getElementById('compteur-essais').innerText = "ESSAIS : 0";
    
    document.getElementById('menu-principal').classList.add('hidden');
    document.getElementById('soustitre-accueil').classList.add('hidden');
    document.getElementById('zone-jeu').classList.remove('hidden');
    document.getElementById('titre-mode').innerText = "MODE " + mode.toUpperCase();
    document.getElementById('message-retour').innerText = "";
    document.getElementById('input-pokemon').value = "";
    document.getElementById('devinette-container').classList.remove('hidden');

    const conteneur = document.getElementById('contenu-dynamique-du-jeu');
    conteneur.innerHTML = '<p style="color: white;">CHARGEMENT...</p>';

    try {
        if (mode === 'classique') await chargerPokemonClassique();
        else if (mode === 'carte') await chargerPokemonCarte();
        else if (mode === 'description') await chargerPokemonDescription();
        else if (mode === 'ombre') await chargerPokemonOmbre();
    } catch (e) {
        conteneur.innerHTML = '<p style="color: white;">ERREUR DE CONNEXION.</p>';
    }
}

async function chargerPokemonClassique(estOmbre = false) {
    const idRandom = Math.floor(Math.random() * 1025) + 1;
    const resSpecies = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${idRandom}`);
    const dataSpecies = await resSpecies.json();
    const resBase = await fetch(`https://pokeapi.co/api/v2/pokemon/${idRandom}`);
    const dataBase = await resBase.json();

    const nomFrObj = dataSpecies.names.find(n => n.language.name === "fr");
    pokemonATrouver = simplifierTexte(nomFrObj ? nomFrObj.name : dataSpecies.name);

    const imageURL = dataBase.sprites.other['official-artwork'].front_default || dataBase.sprites.front_default;
    const styleFiltre = estOmbre ? "filter: brightness(0);" : "filter: brightness(1);";

    document.getElementById('contenu-dynamique-du-jeu').innerHTML = `
        <div style="text-align: center; margin: 20px;">
            <img id="image-pokemon" src="${imageURL}" style="width: 200px; transition: filter 0.5s ease; ${styleFiltre}">
        </div>`;
}

async function chargerPokemonOmbre() { await chargerPokemonClassique(true); }

async function chargerPokemonCarte() {
    const idRandom = Math.floor(Math.random() * 1025) + 1;
    const resSpecies = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${idRandom}`);
    const dataSpecies = await resSpecies.json();
    const resCard = await fetch(`https://api.tcgdex.net/v2/fr/cards?name=${dataSpecies.name}`);
    const cardsData = await resCard.json();
    const validCards = cardsData.filter(c => c.image !== undefined);
    
    if (validCards.length === 0) return chargerPokemonCarte();

    const nomFrObj = dataSpecies.names.find(n => n.language.name === "fr");
    pokemonATrouver = simplifierTexte(nomFrObj ? nomFrObj.name : dataSpecies.name);

    const carte = validCards[Math.floor(Math.random() * validCards.length)];
    document.getElementById('contenu-dynamique-du-jeu').innerHTML = `
        <div style="text-align: center; margin: 20px;">
            <img id="image-pokemon" src="${carte.image}/high.webp" 
                 style="filter: blur(${flouActuel}px) brightness(0.8); width: 240px; border-radius:10px; transition: filter 0.5s;">
        </div>`;
}

async function chargerPokemonDescription() {
    const idRandom = Math.floor(Math.random() * 1025) + 1;
    const resSpecies = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${idRandom}`);
    const dataSpecies = await resSpecies.json();
    const nomFrObj = dataSpecies.names.find(n => n.language.name === "fr");
    const nomReel = nomFrObj ? nomFrObj.name : dataSpecies.name;
    pokemonATrouver = simplifierTexte(nomReel);

    const entriesFr = dataSpecies.flavor_text_entries.filter(e => e.language.name === "fr");
    let texte = entriesFr[Math.floor(Math.random() * entriesFr.length)].flavor_text;
    const regex = new RegExp(nomReel, "gi");
    let texteFinal = texte.replace(regex, "[ POKEMON ]").replace(/[\f\n\r]/g, ' ').normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();

    document.getElementById('contenu-dynamique-du-jeu').innerHTML = `
        <div class="card" style="width: 85%; max-width: 400px; margin: 20px auto; background:#f9f6d8; border:4px solid #2f4f2f; padding:15px; box-shadow: 4px 4px 0px #2f4f2f;">
            <p style="font-size: 16px; color: #2f4f2f; font-family: Arial, sans-serif; line-height: 1.4; margin: 0;">"${texteFinal}"</p>
        </div>`;
}

function verifierReponse() {
    const input = document.getElementById('input-pokemon');
    const saisie = simplifierTexte(input.value);
    const message = document.getElementById('message-retour');
    const image = document.getElementById('image-pokemon');

    if (saisie === pokemonATrouver) {
        message.innerText = "BRAVO ! TU AS TROUVE EN " + (essais + 1) + " ESSAI ";
        message.style.color = "#6ddc8c";
        if (image) image.style.filter = "blur(0px) brightness(1)";
    } else {
        essais++;
        document.getElementById('compteur-essais').innerText = "ESSAIS : " + essais;
        if (modeActuel === 'carte' && image && flouActuel > 0) {
            flouActuel = Math.max(0, flouActuel - 4);
            image.style.filter = `blur(${flouActuel}px) brightness(0.8)`;
        }
        message.innerText = "CE N'EST PAS CA...";
        message.style.color = "#ff4d4d";
        input.value = "";
    }
}

function retourMenu() {
    document.getElementById('menu-principal').classList.remove('hidden');
    document.getElementById('soustitre-accueil').classList.remove('hidden');
    document.getElementById('zone-jeu').classList.add('hidden');
}

document.getElementById('input-pokemon').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') verifierReponse();
});
</script>
</body>
</html>